<!--
Single-file HTML: "Vui h·ªçc ph√©p nh√¢n" ‚Äî Phi√™n b·∫£n n√¢ng c·∫•p
M·ª•c ti√™u: Theo ƒë√∫ng g·ª£i √Ω ‚Äî giao di·ªán d·ªÖ th∆∞∆°ng, ch·ªØ to, √¢m thanh ho·∫°t ƒë·ªông (Web Speech API), h√¨nh minh h·ªça ph√π h·ª£p v·ªõi v√≠ d·ª•, t√™n app "Vui h·ªçc ph√©p nh√¢n", b·∫£ng c·ª≠u ch∆∞∆°ng d·ªÖ th∆∞∆°ng v√† ph·∫ßn luy·ªán t·∫≠p. 
H∆∞·ªõng d·∫´n: L∆∞u file d∆∞·ªõi t√™n vui-hoc-phep-nhan.html v√† m·ªü b·∫±ng tr√¨nh duy·ªát hi·ªán ƒë·∫°i (Chrome/Edge/Safari). N·∫øu n√∫t nghe ch∆∞a n√≥i, nh·∫•n 1 l·∫ßn v√†o trang ƒë·ªÉ cho ph√©p √¢m thanh (m·ªôt s·ªë tr√¨nh duy·ªát y√™u c·∫ßu t∆∞∆°ng t√°c ng∆∞·ªùi d√πng).
-->

<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Vui h·ªçc ph√©p nh√¢n</title>
    <style>
      :root {
        --bg1: linear-gradient(180deg, #fffaf0, #fff7fb);
        --card: #ffffff;
        --accent: #8ad7c9; /* mint */
        --accent2: #ffd6a5; /* peach */
        --cute: #ffd1e0;
        --text: #2b2b2b;
        --muted: #6b6b6b;
        --round: 18px;
        font-family: "Nunito", "Segoe UI", Roboto, "Noto Sans", Arial,
          sans-serif;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        padding: 22px;
        background: var(--bg1);
        color: var(--text);
      }

      .app {
        max-width: 1100px;
        margin: 0 auto;
      }
      header {
        display: flex;
        gap: 16px;
        align-items: center;
      }
      .logo {
        width: 96px;
        height: 96px;
        border-radius: 18px;
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 42px;
        box-shadow: 0 10px 30px rgba(17, 24, 39, 0.08);
      }
      h1 {
        font-size: 30px;
        margin: 0;
      }
      p.lead {
        margin: 6px 0 20px;
        color: var(--muted);
        font-size: 15px;
      }

      .grid {
        display: grid;
        grid-template-columns: 360px 1fr;
        gap: 18px;
        margin-top: 12px;
      }

      .panel {
        background: var(--card);
        border-radius: var(--round);
        padding: 16px;
        box-shadow: 0 8px 30px rgba(17, 24, 39, 0.06);
      }
      .nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .nav button {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        border-radius: 12px;
        border: none;
        background: transparent;
        font-size: 16px;
        cursor: pointer;
      }
      .nav button.active {
        background: linear-gradient(90deg, var(--accent), #c7f0e4);
        font-weight: 800;
      }

      .small-muted {
        font-size: 13px;
        color: var(--muted);
      }
      select {
        padding: 8px;
        border-radius: 10px;
        border: 1px solid #eee;
      }

      main .stage {
        background: var(--card);
        border-radius: var(--round);
        padding: 18px;
        min-height: 520px;
      }

      .concept {
        display: flex;
        gap: 20px;
        align-items: flex-start;
      }
      .visual {
        width: 280px;
        border-radius: 14px;
        background: linear-gradient(180deg, #fff, #fff8ec);
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
        justify-content: center;
      }
      .visual .group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .visual .group .card {
        background: linear-gradient(180deg, #fff, #fffbe6);
        padding: 8px;
        border-radius: 12px;
        min-width: 46px;
        text-align: center;
        font-size: 28px;
      }

      .big {
        font-size: 36px;
        font-weight: 900;
      }
      .explain {
        font-size: 18px;
        margin-top: 10px;
        color: var(--muted);
      }

      .controls {
        display: flex;
        gap: 10px;
        margin-top: 14px;
      }
      .btn {
        padding: 12px 14px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-weight: 800;
      }
      .btn-voice {
        background: var(--accent);
        color: #fff;
      }
      .btn-next {
        background: var(--accent2);
      }

      /* cute animal avatar */
      .mascot {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .mascot img {
        width: 56px;
        height: 56px;
      }

      /* table */
      .mul-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        margin-top: 12px;
      }
      .mul-card {
        background: linear-gradient(180deg, #fff, #fffbf7);
        padding: 12px;
        border-radius: 12px;
        text-align: center;
        font-weight: 800;
      }
      .mul-card .small {
        font-size: 13px;
        color: var(--muted);
      }
      .mul-card .bigval {
        font-size: 20px;
        margin-top: 6px;
      }

      /* practice */
      .question {
        font-size: 26px;
        font-weight: 900;
        margin-bottom: 12px;
      }
      .choices {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      .choice {
        padding: 14px;
        border-radius: 12px;
        background: #fff;
        font-size: 20px;
        cursor: pointer;
        border: 3px solid transparent;
      }
      .choice:hover {
        transform: translateY(-3px);
      }
      .choice.correct {
        border-color: #63c77a;
      }
      .choice.wrong {
        border-color: #ff7b7b;
      }

      .scorebar {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 12px;
      }

      footer {
        margin-top: 18px;
        font-size: 13px;
        color: var(--muted);
      }

      @media (max-width: 960px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .visual {
          width: 220px;
        }
        .mul-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="app" role="application">
      <header>
        <div class="logo" aria-hidden>üß∏</div>
        <div>
          <h1>Vui h·ªçc ph√©p nh√¢n</h1>
          <p class="lead">
            H·ªçc b·∫±ng h√¨nh ·∫£nh, √¢m thanh v√† tr√≤ ch∆°i ‚Äî D√†nh cho h·ªçc sinh l·ªõp 1
          </p>
        </div>
      </header>

      <div class="grid">
        <aside class="panel" aria-label="Thanh ƒëi·ªÅu h∆∞·ªõng">
          <div class="nav">
            <button class="active" data-panel="concept">
              1. L√†m quen v·ªõi nh√¢n
            </button>
            <button data-panel="table">2. B·∫£ng c·ª≠u ch∆∞∆°ng</button>
            <button data-panel="practice">3. Luy·ªán t·∫≠p</button>
          </div>

          <div style="margin-top: 12px" class="small-muted">Ch·ªçn b·∫£ng:</div>
          <div style="margin-top: 6px">
            <select id="select-times" aria-label="Ch·ªçn nh√¢n">
              <option value="2">Nh√¢n 2</option>
              <option value="3">Nh√¢n 3</option>
              <option value="4">Nh√¢n 4</option>
              <option value="5">Nh√¢n 5</option>
              <option value="6">Nh√¢n 6</option>
              <option value="7">Nh√¢n 7</option>
              <option value="8">Nh√¢n 8</option>
              <option value="9">Nh√¢n 9</option>
            </select>
          </div>

          <div style="margin-top: 12px" class="small-muted">T·ªïng ƒëi·ªÉm:</div>
          <div style="font-size: 20px; font-weight: 800; margin-top: 6px">
            <span id="score">0</span> ‚≠ê
          </div>

          <div style="margin-top: 18px; font-size: 13px; color: var(--muted)">
            L∆∞u √Ω: Nh·∫•n v√†o n√∫t ph√°t √¢m thanh (üîä). N·∫øu ch∆∞a nghe, t∆∞∆°ng t√°c v·ªõi
            trang (click) ƒë·ªÉ cho ph√©p √¢m thanh tr√™n m·ªôt s·ªë tr√¨nh duy·ªát.
          </div>
        </aside>

        <main>
          <section class="stage" id="stage" aria-live="polite">
            <!-- JS s·∫Ω render n·ªôi dung ·ªü ƒë√¢y -->
          </section>
        </main>
      </div>

      <footer>
        Thi·∫øt k·∫ø: ch·ªØ l·ªõn, m√†u pastel, nh√¢n v·∫≠t d·ªÖ th∆∞∆°ng. Gi·ªçng ƒë·ªçc d√πng Web
        Speech API (ti·∫øng Vi·ªát n·∫øu c√≥).
      </footer>
    </div>

    <script>
      // --- TTS helper (Web Speech API) ---
      function speak(text) {
        if (!("speechSynthesis" in window)) return;
        const u = new SpeechSynthesisUtterance(text);
        // try to pick a Vietnamese voice if available
        const voices = speechSynthesis.getVoices();
        if (voices && voices.length) {
          const vi = voices.find((v) =>
            /vi|vietnam|vietnamese/i.test(v.lang || v.name)
          );
          if (vi) u.voice = vi;
        }
        u.rate = 0.95;
        u.pitch = 1.05;
        u.volume = 1;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
      }

      // --- state ---
      const state = { panel: "concept", times: 2, score: 0, current: null };

      // --- renderers ---
      function renderConcept() {
        return `
        <div class="concept">
          <div class="visual" id="visual">
            <div style="font-size:14px;color:var(--muted)">V√≠ d·ª• tr·ª±c quan</div>
            <div class="group" id="group-area" aria-hidden style="margin-top:6px"></div>
            <div class="explain" id="example-text"></div>
            <div class="controls">
              <button class="btn btn-voice" id="play-example">üîä Nghe v√≠ d·ª•</button>
              <button class="btn btn-next" id="next-example">üîÅ V√≠ d·ª• kh√°c</button>
            </div>
          </div>

          <div style="flex:1">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div>
                <div style="font-size:20px;font-weight:800">Minigame: K√©o-th·∫£ ho√†n th√†nh ph√©p nh√¢n</div>
                <div class="small-muted">K√©o s·ªë v√†o √¥ ƒë·ªÉ tr·∫£ l·ªùi</div>
              </div>
              <div class="mascot"><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 100 100'><g><circle cx='50' cy='50' r='46' fill='%23ffdede'/><circle cx='35' cy='38' r='8' fill='%23fff'/><circle cx='65' cy='38' r='8' fill='%23fff'/><circle cx='35' cy='38' r='4' fill='%23000'/><circle cx='65' cy='38' r='4' fill='%23000'/><path d='M30 62 q20 18 40 0' stroke='%23000' stroke-width='4' fill='none' stroke-linecap='round'/></g></svg>" alt="G·∫•u d·ªÖ th∆∞∆°ng"></div>
            </div>

            <div style="margin-top:14px;background:linear-gradient(180deg,#fff,#f8fff8);padding:12px;border-radius:12px">
              <div id="drop-area" style="min-height:56px;padding:12px;border-radius:10px;border:2px dashed #f0f0f0;display:flex;align-items:center;justify-content:center">K√©o s·ªë v√†o ƒë√¢y</div>
              <div style="margin-top:12px">S·ªë ƒë·ªÉ k√©o:</div>
              <div id="drags" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
            </div>

            <div style="margin-top:12px;color:var(--muted);font-size:14px">M·∫πo: ch·ªçn b·∫£ng nh√¢n ·ªü b√™n tr√°i tr∆∞·ªõc khi luy·ªán v√≠ d·ª•.</div>
          </div>
        </div>
      `;
      }

      function renderTable() {
        // build small cards for 1..10
        let cards = "";
        for (let i = 1; i <= 10; i++) {
          cards += `<div class="mul-card" role="listitem"><div class="small">${
            state.times
          } √ó ${i}</div><div class="bigval">${state.times * i}</div></div>`;
        }
        return `
        <div>
          <div style="display:flex;align-items:center;justify-content:space-between"><h2 style="margin:0">B·∫£ng c·ª≠u ch∆∞∆°ng: Nh√¢n ${state.times}</h2><div><button class="btn btn-voice" id="play-table">üîä Nghe to√†n b·ªô</button></div></div>
          <p class="small-muted" style="margin-top:6px">M·ªói √¥ c√≥ gi√° tr·ªã l·ªõn, ch·ªØ to ƒë·ªÉ b√© d·ªÖ ƒë·ªçc.</p>
          <div class="mul-grid" style="margin-top:12px">${cards}</div>
        </div>
      `;
      }

      function renderPractice() {
        return `
        <div>
          <h2 style="margin:0 0 8px 0">Luy·ªán t·∫≠p: Nh√¢n ${state.times}</h2>
          <div class="question" id="question-text">--</div>
          <div class="choices" id="choices"></div>
          <div class="scorebar"><div>ƒêi·ªÉm: <strong id="local-score">0</strong></div><div style="margin-left:auto"> <button class="btn btn-voice" id="read-q">üîä ƒê·ªçc c√¢u</button> <button class="btn btn-next" id="new-q">C√¢u kh√°c</button></div></div>
        </div>
      `;
      }

      // --- main render ---
      function render() {
        const stage = document.getElementById("stage");
        if (!stage) return;
        if (state.panel === "concept") stage.innerHTML = renderConcept();
        if (state.panel === "table") stage.innerHTML = renderTable();
        if (state.panel === "practice") stage.innerHTML = renderPractice();

        document
          .querySelectorAll(".nav button")
          .forEach((b) =>
            b.classList.toggle("active", b.dataset.panel === state.panel)
          );

        // setup after render
        if (state.panel === "concept") setupConcept();
        if (state.panel === "table") setupTable();
        if (state.panel === "practice") setupPractice();
      }

      // --- concept setup ---
      function setupConcept() {
        const group = document.getElementById("group-area");
        const exampleText = document.getElementById("example-text");
        const drags = document.getElementById("drags");
        const drop = document.getElementById("drop-area");
        const play = document.getElementById("play-example");
        const next = document.getElementById("next-example");

        function makeExample() {
          const a = Math.floor(Math.random() * 3) + 1; // 1..3 groups
          const b = Math.floor(Math.random() * 3) + 1; // 1..3 per group
          const emojiSet = ["üçé", "üêª", "üê∂", "üê±", "ü¶ä", "üçå", "üçì"];
          const emoji = emojiSet[Math.floor(Math.random() * emojiSet.length)];
          group.innerHTML = "";
          for (let i = 0; i < a; i++) {
            const card = document.createElement("div");
            card.className = "card";
            for (let j = 0; j < b; j++) card.innerHTML += emoji;
            card.style.fontSize = "28px";
            card.style.padding = "8px";
            card.style.display = "inline-block";
            card.style.margin = "6px";
            card.style.borderRadius = "10px";
            group.appendChild(card);
          }
          exampleText.textContent = `${a} nh√≥m, m·ªói nh√≥m ${b} c√°i ‚Üí ${a} √ó ${b} = ${
            a * b
          }`;

          // draggables (1..12)
          drags.innerHTML = "";
          for (let n = 1; n <= 12; n++) {
            const d = document.createElement("div");
            d.textContent = n;
            d.draggable = true;
            d.className = "drag-item";
            d.style.padding = "8px 10px";
            d.style.background = "#fff";
            d.style.borderRadius = "10px";
            d.style.cursor = "grab";
            d.style.fontWeight = "700";
            d.style.border = "1px solid #f0f0f0";
            drags.appendChild(d);
            d.addEventListener("dragstart", (e) =>
              e.dataTransfer.setData("text/plain", n)
            );
          }

          drop.innerHTML = `<div style="min-height:42px;display:flex;align-items:center;justify-content:center">K√©o s·ªë t∆∞∆°ng ·ª©ng (${
            a * b
          }) v√†o ƒë√¢y</div>`;
          drop.ondragover = (e) => e.preventDefault();
          drop.ondrop = (e) => {
            e.preventDefault();
            const val = +e.dataTransfer.getData("text/plain");
            if (val === a * b) {
              drop.innerHTML =
                '<div style="padding:8px;background:#eaffef;border-radius:8px">Ch√≠nh x√°c! ' +
                val +
                " üéâ</div>";
              speak("Ch√≠nh x√°c! " + a + " nh√¢n " + b + " b·∫±ng " + a * b);
              state.score += 1;
              updateScore();
            } else {
              drop.innerHTML =
                '<div style="padding:8px;background:#ffecec;border-radius:8px">Ch∆∞a ƒë√∫ng, th·ª≠ l·∫°i nh√©</div>';
              speak("Ch∆∞a ƒë√∫ng, th·ª≠ l·∫°i nh√©");
            }
          };

          state.current = { type: "example", a, b };
        }

        makeExample();
        play.onclick = () => {
          if (state.current)
            speak(
              `${state.current.a} nh√≥m, m·ªói nh√≥m ${state.current.b} c√°i. ${
                state.current.a
              } nh√¢n ${state.current.b} b·∫±ng ${
                state.current.a * state.current.b
              }`
            );
        };
        next.onclick = () => makeExample();
      }

      // --- table setup ---
      function setupTable() {
        document.getElementById("play-table").onclick = () => {
          let text = `B·∫£ng nh√¢n ${state.times}: `;
          for (let i = 1; i <= 10; i++) {
            text += `${state.times} nh√¢n ${i} b·∫±ng ${state.times * i}. `;
          }
          speak(text);
        };
      }

      // --- practice setup ---
      function setupPractice() {
        const qText = document.getElementById("question-text");
        const choicesWrap = document.getElementById("choices");
        const localScoreEl = document.getElementById("local-score");

        function newQ() {
          const a = state.times;
          const b = Math.floor(Math.random() * 9) + 1; // 1..9
          const correct = a * b;
          state.current = { type: "practice", a, b, correct };
          qText.textContent = `${a} √ó ${b} = ?`;

          const opts = new Set([correct]);
          while (opts.size < 4) {
            let cand = correct + (Math.floor(Math.random() * 11) - 5);
            if (cand < 1) cand = Math.abs(cand) + 1;
            opts.add(cand);
          }
          const arr = Array.from(opts).sort(() => Math.random() - 0.5);
          choicesWrap.innerHTML = "";
          arr.forEach((val) => {
            const d = document.createElement("div");
            d.className = "choice";
            d.textContent = val;
            d.tabIndex = 0;
            d.addEventListener("click", () => select(d, val));
            d.addEventListener("keydown", (e) => {
              if (e.key === "Enter") select(d, val);
            });
            choicesWrap.appendChild(d);
          });
          localScoreEl.textContent = 0;
        }

        function select(el, val) {
          const correct = state.current.correct;
          if (+val === correct) {
            el.classList.add("correct");
            speak("Ch√≠nh x√°c!");
            state.score += 1;
            updateScore();
            const cur = +localScoreEl.textContent;
            localScoreEl.textContent = cur + 1;
          } else {
            el.classList.add("wrong");
            speak("Ch∆∞a ƒë√∫ng. C·ªë g·∫Øng nh√©");
          }
          // disable
          document
            .querySelectorAll(".choice")
            .forEach((c) => (c.onclick = null));
        }

        document.getElementById("new-q").onclick = () => newQ();
        document.getElementById("read-q").onclick = () => {
          const q = state.current;
          if (q) speak(`${q.a} nh√¢n ${q.b} b·∫±ng bao nhi√™u?`);
        };
        newQ();
      }

      // update score display
      function updateScore() {
        document.getElementById("score").textContent = state.score;
      }

      // nav handlers
      document.querySelectorAll(".nav button").forEach((b) =>
        b.addEventListener("click", () => {
          state.panel = b.dataset.panel;
          render();
        })
      );
      document
        .getElementById("select-times")
        .addEventListener("change", (e) => {
          state.times = +e.target.value;
          render();
        });

      // initial render
      render();

      // ensure voices loaded for some browsers
      if (speechSynthesis && speechSynthesis.onvoiceschanged !== undefined)
        speechSynthesis.onvoiceschanged = () => {};

      // small accessibility: allow first user click to enable audio on some mobile browsers
      document.body.addEventListener(
        "click",
        () => {
          if (speechSynthesis) speechSynthesis.getVoices();
        },
        { once: true }
      );
    </script>
  </body>
</html>
