<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Vui h·ªçc ph√©p nh√¢n</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg: #fff9f2;
        --card: #fff;
        --accent: #ff8c94;
        --accent2: #ffd166;
        --text: #3b3b3b;
        --shadow: 0 8px 20px rgba(38, 38, 38, 0.08);
        font-family: "Baloo 2", sans-serif;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        background: linear-gradient(180deg, var(--bg), #fff5f0);
        color: var(--text);
      }
      .app {
        max-width: 980px;
        margin: 20px auto;
        padding: 20px;
      }
      header {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .logo {
        width: 84px;
        height: 84px;
        border-radius: 18px;
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow);
      }
      h1 {
        font-size: 28px;
        margin: 0;
      }
      p.lead {
        margin: 4px 0 16px;
        color: #5b5b5b;
      }

      .controls {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 18px;
      }
      .card {
        background: var(--card);
        border-radius: 14px;
        padding: 12px;
        box-shadow: var(--shadow);
      }

      .control-item {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      label {
        font-weight: 600;
      }
      input[type="range"] {
        width: 220px;
      }
      .big {
        font-size: 20px;
        font-weight: 700;
      }

      .visual {
        display: flex;
        gap: 12px;
        align-items: flex-start;
      }
      .canvas {
        flex: 1;
        background: linear-gradient(180deg, #fff, #fffcf9);
        border-radius: 12px;
        padding: 14px;
        min-height: 220px;
      }

      .groups {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .group {
        background: #fff5f6;
        border-radius: 10px;
        padding: 8px;
        min-width: 78px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.04);
      }
      .items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
      }
      .item {
        width: 42px;
        height: 42px;
        border-radius: 6px;
        background: linear-gradient(180deg, #fff, #ffecec);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
      }

      .right {
        width: 320px;
      }
      .equation {
        font-size: 40px;
        font-weight: 800;
        margin: 8px 0;
      }
      .result {
        font-size: 40px;
        color: var(--accent);
        font-weight: 900;
      }

      .btn {
        display: inline-block;
        padding: 10px 12px;
        border-radius: 10px;
        background: var(--accent);
        color: white;
        text-decoration: none;
        cursor: pointer;
        border: none;
      }
      .btn.secondary {
        background: #ffd166;
        color: #4b3621;
      }
      .quiz {
        margin-top: 14px;
      }

      footer {
        margin-top: 18px;
        font-size: 13px;
        color: #666;
      }

      /* mobile tweaks */
      @media (max-width: 900px) {
        .visual {
          flex-direction: column;
        }
        .right {
          width: 100%;
        }
      }

      /* --- Multiplication Table Cute Style --- */
      #multiplicationButtons button {
        background: #ffd8e4;
        border: none;
        padding: 10px 14px;
        margin: 5px;
        font-size: 20px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.25s;
      }

      #multiplicationButtons button.active {
        background: #ff5fa2;
        color: white;
        transform: scale(1.15);
      }

      #multiplicationButtons button:hover {
        background: #ff9bc4;
      }

      #multiplicationDisplay {
        margin-top: 18px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      /* M·ªói d√≤ng b·∫£ng nh√¢n */
      #multiplicationDisplay div {
        font-size: 24px; /* nh·ªè l·∫°i v·ª´a ƒë·ªß cho b√© nh√¨n */
        font-weight: 600;
        padding: 10px 14px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.7);
        transition: transform 0.2s, background 0.2s;
      }

      #multiplicationDisplay div:hover {
        transform: scale(1.05);
        background: rgba(255, 255, 255, 0.95);
      }

      #multiplicationDisplay div:active {
        transform: scale(1.12);
      }

      /* N√∫t ƒë·ªçc b·∫£ng */
      #readTableBtn {
        margin-top: 15px;
        background: #ff5fa2;
        color: white;
        font-size: 20px;
        padding: 12px 18px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        transition: 0.25s;
      }

      #readTableBtn:hover {
        background: #ff3f87;
      }

      /* Game Cards */
      #gameArea {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
        margin-top: 20px;
      }

      .game-card {
        background: #fffce6;
        border: 2px solid #ffd777;
        border-radius: 14px;
        padding: 14px 8px; /* gi·∫£m chi·ªÅu cao */
        font-size: 24px;
        text-align: center;
        cursor: pointer;
        transition: 0.25s;
        user-select: none;

        /* Thay ƒë·ªïi h√¨nh d·∫°ng t·ª´ d·ªçc ‚Üí ngang */
        height: 70px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .game-card:hover:not(.matched) {
        background: #ffefb7;
        transform: scale(1.06);
      }

      .game-card.matched {
        background: #bbffcd;
        border-color: #39b55a;
        transform: scale(1.1);
      }

      #newGameBtn {
        margin-top: 15px;
        background: #ffb100;
        color: #fff;
        font-size: 20px;
        padding: 10px 18px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
      }

      #newGameBtn:hover {
        background: #ff9a00;
      }

      #timerDisplay.blink {
        animation: blink 0.6s infinite;
      }

      @keyframes blink {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
        100% {
          opacity: 1;
        }
      }

      .sticker-earned {
        font-size: 60px;
        animation: pop 0.7s ease-out;
      }

      @keyframes pop {
        0% {
          transform: scale(0.3);
          opacity: 0;
        }
        70% {
          transform: scale(1.4);
          opacity: 1;
        }
        100% {
          transform: scale(1);
        }
      }

      #tablesSection {
        display: none;
      }

      /* small helper for fade */
      .fade {
        transition: opacity 220ms ease, transform 220ms ease;
      }

      body,
      button,
      input {
        font-size: 18px;
      }

      /* --- B·∫£ng c·ª≠u ch∆∞∆°ng d·∫°ng th·∫ª ƒë·∫πp --- */
      #multiplicationDisplay {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      #multiplicationDisplay div {
        background: #fff7fb;
        border: 2px solid #ffbad8;
        border-radius: 14px;
        padding: 14px 8px;
        font-size: 22px;
        font-weight: 700;
        text-align: center;
        transition: transform 0.2s, background 0.2s;
      }

      #multiplicationDisplay div:hover {
        transform: scale(1.08);
        background: #ffe6f1;
      }

      /* --- Game v√πng 4 c·ªôt ƒë·ªÅu & ƒë·∫πp --- */
      #gameArea {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
        margin-top: 20px;
      }

      .practice-menu .btn {
        font-size: 16px;
      }
      /* --- Game 1 --- */

      /* Container */
      #shootGame {
        max-width: 900px;
        margin: 0 auto;
        background: linear-gradient(180deg, var(--bg-1), var(--bg-2));
        border-radius: 18px;
        padding: 18px;
        box-shadow: 0 8px 30px rgba(50, 30, 50, 0.06);
      }

      /* Control panel (compact row) */
      .control-panel {
        display: flex;
        gap: 18px;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .control-label {
        margin-right: 10px;
        font-weight: bold;
      }

      .speed-btn {
        padding: 6px 16px;
        border-radius: 12px;
        border: 2px solid #ffb100;
        background: #fff;
        cursor: pointer;
        margin: 0 4px;
        font-size: 14px;
      }
      .speed-btn.active {
        background: #ff71a5;
        border: none;
        color: #fff;
      }

      .question-box {
        background: linear-gradient(180deg, #fff, #fff0f6);
        border-radius: 14px;
        padding: 12px 20px;
        font-size: 34px;
        font-weight: 800;
        color: var(--accent);
        box-shadow: 0 6px 12px rgba(255, 110, 160, 0.12);
        min-width: 220px;
        text-align: center;
      }
  /* Balloon area */
      #balloonArea {
        margin-top: 14px;
        width: 100%;
        height: 360px;
        border-radius: 16px;
        overflow: hidden;
        position: relative;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.15)
        );
        border: 1px solid rgba(255, 200, 220, 0.4);
      }

      /* Balloons (pastel round) */
      .balloon {
        position: absolute;
        width: 68px;
        height: 68px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: 800;
        color: #053d5a;
        text-shadow: 0 0 3px #ffffffaa;
        cursor: pointer;
        /* M√ÄU BONG B√ìNG ƒê·∫¨M ‚Äì TRONG ‚Äì S√ÅNG */
        background: radial-gradient(
          circle at 35% 35%,
          #ffffffee 8%,
          /* s√°ng ·ªü t√¢m */ #8fe2ffdd 40%,
          /* xanh trong m√°t */ #3bb8ffdd 85% /* vi·ªÅn ƒë·∫≠m h∆°n r√µ */
        );

        /* VI·ªÄN PH·∫¢N CHI·∫æU */
        border: 3px solid #47bfff;

        /* TƒÇNG ƒê·ªò N·ªîI */
        box-shadow: inset -6px -8px 14px rgba(0, 90, 160, 0.18),
          0 0 14px rgba(80, 190, 255, 0.55), 0 8px 18px rgba(0, 60, 100, 0.1);
        user-select: none;
        transform: translateY(0);
        transition: transform 0.14s ease, box-shadow 0.14s ease;
        z-index: 10;
        pointer-events: auto;
      }
      .balloon:hover {
        transform: scale(1.12) translateY(-4px);
        box-shadow: 0 14px 28px rgba(255, 110, 160, 0.18);
      }

      /* float from bottom to top */
      @keyframes floatUp {
        from {
          transform: translateY(0);
          opacity: 1;
        }
        to {
          transform: translateY(-520px);
          opacity: 0;
        }
      }

      /* pop (longer, soft) */
      .pop {
        animation: popBalloon 0.65s ease-out forwards;
        transform-origin: center center;
        z-index: 100;
      }
      @keyframes popBalloon {
        0% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
        30% {
          transform: scale(1.4) rotate(5deg);
          opacity: 1;
        }
        60% {
          transform: scale(1.8) rotate(-5deg);
          opacity: 0.8;
        }
        100% {
          transform: scale(0) rotate(15deg);
          opacity: 0;
        }
      }

      /* candy splash pieces */
      .candy-splash {
        position: absolute;
        font-size: 24px;
        pointer-events: none;
        transform-origin: center;
        opacity: 1;
        z-index: 200;
      }
      @keyframes candyFly {
        0% {
          opacity: 1;
          transform: translate(0, 0) scale(1) rotate(0deg);
        }
        50% {
          opacity: 1;
          transform: translate(var(--dx-mid, 0), var(--dy-mid, 0)) scale(1.2) rotate(180deg);
        }
        100% {
          opacity: 0;
          transform: translate(var(--dx, 0), var(--dy, 0)) scale(0.5)
            rotate(360deg);
        }
      }

      /* small helpers */
      .controls-row {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .btn {
        background: var(--accent);
        color: white;
        padding: 8px 12px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-weight: 700;
      }
      .btn.secondary {
        background: #ffd166;
        color: #4b3621;
      }

      /* level badge */
      .level-badge {
        background: #fff0f0;
        padding: 6px 10px;
        border-radius: 10px;
        font-weight: 800;
        color: #ff6a8b;
      }

      /* responsiveness */
      @media (max-width: 720px) {
        .control-panel {
          flex-direction: column;
          align-items: stretch;
          gap: 12px;
        }

        .question-box {
          font-size: 28px;
          min-width: auto;
          text-align: center;
        }
      }
      /* --- Game 2 --- */
      .drag-card {
        background: #ffe8f8;
        border-radius: 14px;
        padding: 14px 12px;
        font-size: 20px;
        font-weight: 700;
        cursor: grab;
        user-select: none;
        transition: transform 0.2s;
      }

      .drag-card:hover {
        transform: scale(1.1);
      }

      .drag-card.correct {
        background: #bbffcd;
        border: 2px solid #39b55a;
        transform: scale(1.15);
      }

      /* --- Game 3 --- */
      .match-item {
        background: #fff0f5;
        padding: 10px 14px;
        border-radius: 12px;
        margin: 8px 0;
        font-size: 20px;
        font-weight: 700;
        cursor: pointer;
        user-select: none;
      }

      .match-item.correct {
        background: #bbffcd;
        border: 2px solid #39b55a;
      }

      /* --- Game 4 --- */
      .odd-card {
        background: #fff4f0;
        border: 2px solid #ff8c94;
        border-radius: 12px;
        padding: 14px 20px;
        font-size: 22px;
        cursor: pointer;
        transition: transform 0.2s, background 0.2s;
      }
      .odd-card:hover {
        transform: scale(1.05);
        background: #ffe6e0;
      }
      .odd-card.correct {
        background: #bbffcd;
        border-color: #39b55a;
      }
      .odd-card.wrong {
        background: #ffd1d1;
        border-color: #ff4b4b;
      }
    </style>
  </head>

  <body>
    <div class="app">
      <header>
        <div class="logo" aria-hidden>
          <span style="font-size: 60px">ü¶Å</span>
        </div>
        <div style="flex: 1">
          <h1>Vui h·ªçc ph√©p nh√¢n</h1>
          <p class="lead">
            Ph√©p nh√¢n l√† m·ªôt c√°ch t√≠nh g·ªçn khi ch√∫ng ta c·ªông nhi·ªÅu l·∫ßn m·ªôt s·ªë
            gi·ªëng nhau.
          </p>

          <div style="margin-top: 12px; display: flex; gap: 12px">
            <button id="modeLearning" class="btn">L√†m quen ph√©p nh√¢n</button>
            <button id="modeTables" class="btn secondary">
              H·ªçc b·∫£ng c·ª≠u ch∆∞∆°ng
            </button>
            <button id="modePractice" class="btn secondary">
              Luy·ªán t·∫≠p t·ªïng h·ª£p
            </button>
          </div>
        </div>
      </header>

      <!-- LEARN SECTION -->
      <div id="learnSection" class="fade" style="margin-top: 16px">
        <section class="controls" aria-label="ƒêi·ªÅu khi·ªÉn">
          <div class="card control-item">
            <label for="groupsCount"
              >S·ªë nh√≥m: <span id="gVal" class="big">3</span></label
            >
            <input id="groupsCount" type="range" min="1" max="8" value="3" />
          </div>

          <div class="card control-item">
            <label for="itemsPerGroup"
              >S·ªë v·∫≠t trong m·ªói nh√≥m:
              <span id="iVal" class="big">4</span></label
            >
            <input id="itemsPerGroup" type="range" min="1" max="8" value="4" />
          </div>

          <div
            class="card control-item"
            style="padding: 10px 12px; justify-content: center"
          >
            <label style="opacity: 0.8">S·ª± v·∫≠t:</label>
            <div style="display: flex; gap: 8px; align-items: center">
              <button class="btn secondary" id="prevIcon" aria-label="tr∆∞·ªõc">
                ‚óÄ
              </button>
              <div
                id="iconPreview"
                style="
                  width: 58px;
                  height: 58px;
                  border-radius: 10px;
                  background: #fff;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 28px;
                "
              >
                üçé
              </div>
              <button class="btn secondary" id="nextIcon" aria-label="sau">
                ‚ñ∂
              </button>
            </div>
          </div>
        </section>

        <div class="visual" style="margin-top: 12px">
          <div class="canvas card" id="canvas" style="flex: 1">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div>
                <div style="font-weight: 800; font-size: 22px">Nh√≥m v√† v·∫≠t</div>
              </div>
              <div style="font-size: 12px; color: #888">Ch·∫°m v√†o ƒë·ªì ƒë·ªÉ ƒë·∫øm</div>
            </div>

            <div class="groups" id="groupsArea" style="margin-top: 12px"></div>

            <div
              style="
                margin-top: 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
              "
            >
              <div>
                <div style="display: flex; align-items: center; gap: 8px">
                  <div class="equation" id="equation">$1</div>
                  <button class="btn" id="speakBtn">üîä</button>
                </div>
                <div>
                  ƒê·ªçc:
                  <span id="spoken" style="font-weight: 700">Ba nh√¢n b·ªën</span>
                </div>
              </div>
              <div style="text-align: right">
                <div style="font-size: 13px; color: #666">T·ªïng s·ªë</div>
                <div class="result" id="totalCount">12</div>
              </div>
            </div>

            <hr
              style="margin: 12px 0; border: none; border-top: 1px dashed #eee"
            />

            <div
              style="
                display: flex;
                gap: 8px;
                align-items: center;
                justify-content: space-between;
              "
            >
              <div style="display: flex; gap: 8px">
                <button class="btn secondary" id="resetBtn">ƒê·∫∑t l·∫°i</button>
                <button class="btn" id="shuffleBtn">V√≠ d·ª• kh√°c</button>
              </div>
              <div style="font-size: 13px; color: #666">
                K·∫øt qu·∫£ hi·ªán t·∫°i cho b√© nh√¨n, nghe v√† ƒë·∫øm.
              </div>
            </div>
          </div>

          <aside class="right">
            <div class="card">
              <div style="font-weight: 800; font-size: 22px">B√†i t·∫≠p nh·ªè</div>
              <div class="quiz" id="quizArea">
                <div style="margin-top: 8px">
                  S·ªë ƒë·ªÅ: <span id="quizStep">1</span>/5
                </div>
                <div
                  id="quizQuestion"
                  style="margin-top: 10px; font-size: 22px; font-weight: 700"
                >
                  M·∫•y nh√≥m? M·∫•y v·∫≠t m·ªói nh√≥m?
                </div>
                <button class="btn" id="speakQuizBtn">üîä</button>

                <div style="margin-top: 10px; display: flex; gap: 8px">
                  <button class="btn" id="answerA">A</button>
                  <button class="btn secondary" id="answerB">B</button>
                </div>
                <div
                  id="quizFeedback"
                  style="margin-top: 8px; height: 22px"
                ></div>
                <button
                  class="btn secondary"
                  id="retryQuizBtn"
                  style="margin-top: 10px; display: none"
                >
                  üîÑ Th·ª±c h√†nh l·∫°i
                </button>
              </div>
            </div>
          </aside>
        </div>
      </div>

      <!-- TABLES & GAME SECTION -->

      <div id="tablesSection" class="fade" style="margin-top: 16px">
        <div class="visual">
          <div style="flex: 1">
            <div class="card" style="margin-top: 12px">
              <div
                style="font-size: 22px; font-weight: 800; margin-bottom: 6px"
              >
                üìö Ch·ªçn b·∫£ng nh√¢n
              </div>

              <div
                id="multiplicationButtons"
                style="
                  display: flex;
                  gap: 6px;
                  flex-wrap: wrap;
                  margin-bottom: 12px;
                "
              ></div>

              <div
                id="multiplicationDisplay"
                style="padding: 10px; background: #fffdf7; border-radius: 10px"
              ></div>

              <button
                class="btn"
                id="readTableBtn"
                style="margin-top: 12px; width: 100%"
              >
                üîä ƒê·ªçc t·∫•t c·∫£ b·∫£ng
              </button>
            </div>
          </div>
          <aside class="right" style="flex-shrink: 0">
            <h2 style="margin-top: 16px; font-size: 22px">
              üéÆ Tr√≤ ch∆°i: L·∫≠t th·∫ª t√¨m c·∫∑p ƒë√∫ng
            </h2>
            <div
              style="
                margin-top: 14px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div
                id="timerDisplay"
                style="font-size: 22px; font-weight: 700; color: #ff5e5e"
              >
                ‚è±Ô∏è 30s
              </div>
              <div id="stickerDisplay" style="font-size: 26px">
                üéÅ Sticker: <span id="stickerCount">0</span> ‚≠ê
              </div>
            </div>
            <div id="gameArea"></div>
            <button
              id="newGameBtn"
              class="btn secondary"
              style="margin-top: 12px"
            >
              Ch∆°i v√°n m·ªõi
            </button>
          </aside>
        </div>
      </div>
      <!-- 4 GAME SECTION -->
      <div id="practiceSection" style="display: none; margin-top: 16px">
        <div class="card" style="padding: 16px; text-align: center">
          <!-- Menu practice -->
          <div class="practice-menu">
            <button class="btn" data-game="shoot">üéØ B·∫Øn b√≥ng</button>
            <button class="btn secondary" data-game="drag">üß© K√©o ‚Äì Th·∫£</button>
            <button class="btn secondary" data-game="memory">üß† L·∫≠t nh·ªõ</button>
            <button class="btn secondary" data-game="odd">
              üîç T√¨m k·∫øt qu·∫£ sai
            </button>
          </div>
        </div>
        <!-- GAME: shootGame -->
        <div id="shootGame" class="practice-game">
          <!-- Control panel -->
          <div class="control-panel">
            <div>
              <span class="control-label">‚ö° T·ªëc ƒë·ªô:</span>
              <button class="speed-btn active" data-speed="4500">Ch·∫≠m</button>
              <button class="speed-btn" data-speed="3000">V·ª´a</button>
              <button class="speed-btn" data-speed="1800">Nhanh</button>
            </div>

            <div>üíé <span id="shootReward">0</span></div>
            <div>üèÜ <span id="shootHighScore">0</span></div>

            <div class="controls-row">
              <label>Level</label>
              <div id="levelBadge" class="level-badge">1</div>
            </div>
          </div>

          <div id="shootQuestion" class="question-box" aria-live="polite">
            5 √ó 7 = ?
          </div>

          <!-- balloonArea -->
          <div
            id="balloonArea"
            role="application"
            aria-label="khu v·ª±c bong b√≥ng"
          ></div>

          <!-- bottom controls -->
          <div
            style="
              margin-top: 12px;
              display: flex;
              gap: 12px;
              justify-content: center;
            "
          >
            <button id="startBtn" class="btn">B·∫Øt ƒë·∫ßu</button>
            <button id="stopBtn" class="btn secondary">D·ª´ng</button>
            <button id="resetHighBtn" class="btn secondary">
              ƒê·∫∑t l·∫°i k·ª∑ l·ª•c
            </button>
          </div>
        </div>

        <!-- GAME: dragGame (placeholder) -->
        <div id="dragGame" class="practice-game" style="display: none; padding: 16px">
          <div class="card" style="padding: 16px; text-align: center">üß© Drag & Drop game is coming soon.</div>
        </div>

        <!-- GAME: memoryGame (placeholder) -->
        <div id="memoryGame" class="practice-game" style="display: none; padding: 16px">
          <div class="card" style="padding: 16px; text-align: center">üß† Memory flip game is coming soon.</div>
        </div>

        <!-- GAME: oddGame (placeholder) -->
        <div id="oddGame" class="practice-game" style="display: none; padding: 16px">
          <div class="card" style="padding: 16px; text-align: center">
            üîç Odd one out game is coming soon.
            <div style="margin-top: 12px">Score: <span id="oddScore">0</span></div>
            <div id="oddOptions" style="margin-top: 12px"></div>
          </div>
        </div>
        <div
          id="dragDropGame"
          class="practice-game"
          style="display: none; text-align: center"
        >
          <h2>üß© K√©o th·∫£ ƒë√°p √°n</h2>
          <p id="dragQuestion" style="font-size: 24px; margin-bottom: 12px">
            ?
          </p>
          <div
            id="answerZone"
            style="
              min-height: 70px;
              width: 180px;
              margin: 0 auto 12px;
              border: 2px dashed #ccc;
              border-radius: 12px;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 22px;
            "
          >
            K√©o th·∫ª v√†o ƒë√¢y
          </div>
          <div
            id="dragCards"
            style="
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
              gap: 12px;
            "
          ></div>
          <p>ƒêi·ªÉm: <span id="dragScore">0</span></p>
        </div>

        <div
          id="matchLineGame"
          class="practice-game"
          style="display: none; text-align: center"
        >
          <h2>üîó N·ªëi ph√©p nh√¢n v·ªõi k·∫øt qu·∫£</h2>
          <div
            id="matchContainer"
            style="
              display: flex;
              justify-content: center;
              gap: 60px;
              margin-top: 20px;
            "
          >
            <div id="leftColumn"></div>
            <div id="rightColumn"></div>
          </div>
          <p>ƒêi·ªÉm: <span id="lineScore">0</span></p>
        </div>

        <div
          id="oddOneOutGame"
          class="practice-game"
          style="display: none; text-align: center"
        >
          <h2>üïµÔ∏è‚Äç‚ôÇÔ∏è Truy t√¨m k·∫ª x√¢m nh·∫≠p</h2>
          <p>Nh·∫•n v√†o ph√©p nh√¢n sai!</p>
          <div
            id="oddOptions"
            style="
              display: flex;
              flex-wrap: wrap;
              gap: 12px;
              justify-content: center;
              margin-top: 16px;
            "
          ></div>
          <p>ƒêi·ªÉm: <span id="oddScore">0</span></p>
        </div>
      </div>

      <footer>
        G·ª£i √Ω: b·∫Øt ƒë·∫ßu b·∫±ng ƒë·ªì th·∫≠t (k·∫πo, b√∫t). Sau b√© hi·ªÉu, d√πng ·ª©ng d·ª•ng n√†y
        ƒë·ªÉ luy·ªán nh·∫≠n bi·∫øt nhanh.
      </footer>
    </div>

    <script>
      // --------------------------
      // DOM refs
      // --------------------------
      const icons = ["üçé", "üç™", "üê∂", "üê±", "üçì", "üçå", "üåü", "üç©"];
      let iconIndex = 0;
      const groupsCountEl = document.getElementById("groupsCount");
      const itemsPerGroupEl = document.getElementById("itemsPerGroup");
      const groupsArea = document.getElementById("groupsArea");
      const gVal = document.getElementById("gVal");
      const iVal = document.getElementById("iVal");
      const equation = document.getElementById("equation");
      const totalCount = document.getElementById("totalCount");
      const spoken = document.getElementById("spoken");
      const iconPreview = document.getElementById("iconPreview");
      const prevIcon = document.getElementById("prevIcon");
      const nextIcon = document.getElementById("nextIcon");
      const speakBtn = document.getElementById("speakBtn");
      const resetBtn = document.getElementById("resetBtn");
      const shuffleBtn = document.getElementById("shuffleBtn");

      const quizStep = document.getElementById("quizStep");
      const quizQuestion = document.getElementById("quizQuestion");
      const answerA = document.getElementById("answerA");
      const answerB = document.getElementById("answerB");
      const quizFeedback = document.getElementById("quizFeedback");
      const speakQuizBtn = document.getElementById("speakQuizBtn");
      const retryQuizBtn = document.getElementById("retryQuizBtn");

      const learnSection = document.getElementById("learnSection");
      const tablesSection = document.getElementById("tablesSection");
      const modeLearning = document.getElementById("modeLearning");
      const modeTables = document.getElementById("modeTables");

      // --------------------------
      // small helpers
      // --------------------------
      function speak(text) {
        if (!("speechSynthesis" in window)) return;
        const ut = new SpeechSynthesisUtterance(text);
        ut.lang = "vi-VN";
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(ut);
      }

      // --------------------------
      // Mode switching
      // --------------------------
      const practiceSection = document.getElementById("practiceSection");
      const modePractice = document.getElementById("modePractice");

      function hidePracticeSection() {
        // ·∫®n practiceSection v√† t·∫•t c·∫£ c√°c game b√™n trong
        practiceSection.style.display = "none";
        document.querySelectorAll(".practice-game").forEach((g) => {
          g.style.display = "none";
        });
      }

      function showLearn() {
        learnSection.style.display = "block";
        tablesSection.style.display = "none";
        hidePracticeSection();

        modeLearning.classList.remove("secondary");
        modeTables.classList.add("secondary");
        modePractice.classList.add("secondary");
      }
      function showTables() {
        learnSection.style.display = "none";
        tablesSection.style.display = "block";
        hidePracticeSection();

        modeTables.classList.remove("secondary");
        modeLearning.classList.add("secondary");
        modePractice.classList.add("secondary");
        // ensure table/game inits when showing tables
        if (!multiplicationButtonsHasChildren()) initMultiplicationButtons();
        updateTable(currentTable);
        createGame();
      }

      function showPractice() {
        learnSection.style.display = "none";
        tablesSection.style.display = "none";
        practiceSection.style.display = "block";

        modePractice.classList.remove("secondary");
        modeLearning.classList.add("secondary");
        modeTables.classList.add("secondary");

        document.querySelectorAll(".practice-menu button").forEach((btn, index) => {
          if (index == 0) { btn.click(); }
        });
      };

      modeLearning.addEventListener("click", showLearn);
      modeTables.addEventListener("click", showTables);
      modePractice.addEventListener("click", showPractice);
      //Game

      document.querySelectorAll(".practice-menu button").forEach((btn) => {
        btn.onclick = () => {
          document
            .querySelectorAll(".practice-game")
            .forEach((g) => (g.style.display = "none"));
          const btnElement = document.getElementById(btn.dataset.game + "Game");
          btnElement.style.display = "block";
        };
      });

      // --------------------------
      // Groups render (learn)
      // --------------------------
      function updatePreview() {
        iconPreview.textContent = icons[iconIndex];
      }
      function toVietnamese(n) {
        const map = [
          "kh√¥ng",
          "m·ªôt",
          "hai",
          "ba",
          "b·ªën",
          "nƒÉm",
          "s√°u",
          "b·∫£y",
          "t√°m",
          "ch√≠n",
        ];
        if (n < 10) return map[n] || n;
        return String(n);
      }
      function renderGroups() {
        const g = Number(groupsCountEl.value);
        const i = Number(itemsPerGroupEl.value);
        gVal.textContent = g;
        iVal.textContent = i;
        equation.textContent = `${g} √ó ${i}`;
        spoken.textContent = toVietnamese(g) + " nh√¢n " + toVietnamese(i);
        totalCount.textContent = g * i;

        groupsArea.innerHTML = "";
        for (let x = 0; x < g; x++) {
          const gEl = document.createElement("div");
          gEl.className = "group";
          const title = document.createElement("div");
          title.style.fontWeight = "700";
          title.textContent = `Nh√≥m ${x + 1}`;
          const itemsWrap = document.createElement("div");
          itemsWrap.className = "items";
          for (let y = 0; y < i; y++) {
            const it = document.createElement("div");
            it.className = "item";
            it.textContent = icons[iconIndex];
            it.setAttribute("role", "button");
            it.tabIndex = 0;
            it.addEventListener("click", () => {
              animateCount(it);
            });
            itemsWrap.appendChild(it);
          }
          gEl.appendChild(title);
          gEl.appendChild(itemsWrap);
          groupsArea.appendChild(gEl);
        }
      }
      function animateCount(el) {
        el.animate(
          [
            { transform: "scale(1)" },
            { transform: "scale(1.15)" },
            { transform: "scale(1)" },
          ],
          { duration: 280 }
        );
        speak("1");
      }

      groupsCountEl.addEventListener("input", renderGroups);
      itemsPerGroupEl.addEventListener("input", renderGroups);
      prevIcon.addEventListener("click", () => {
        iconIndex = (iconIndex - 1 + icons.length) % icons.length;
        updatePreview();
        renderGroups();
      });
      nextIcon.addEventListener("click", () => {
        iconIndex = (iconIndex + 1) % icons.length;
        updatePreview();
        renderGroups();
      });
      speakBtn.addEventListener("click", () => {
        const g = Number(groupsCountEl.value);
        const i = Number(itemsPerGroupEl.value);
        speak(toVietnamese(g) + " nh√¢n " + toVietnamese(i));
      });
      resetBtn.addEventListener("click", () => {
        groupsCountEl.value = 3;
        itemsPerGroupEl.value = 4;
        iconIndex = 0;
        updatePreview();
        renderGroups();
      });
      shuffleBtn.addEventListener("click", () => {
        groupsCountEl.value = Math.floor(Math.random() * 7) + 1;
        itemsPerGroupEl.value = Math.floor(Math.random() * 7) + 1;
        iconIndex = Math.floor(Math.random() * icons.length);
        updatePreview();
        renderGroups();
      });

      // --------------------------
      // Quiz (learn)
      // --------------------------
      const quizStories = [
        {
          story:
            "Mai c√≥ 3 gi·ªè t√°o, m·ªói gi·ªè ƒë·ªÅu c√≥ 4 qu·∫£. C√¥ ·∫•y mu·ªën ƒëem t·∫•t c·∫£ t√°o ƒëi chia cho b·∫°n b√®. H·ªèi Mai c√≥ t·∫•t c·∫£ bao nhi√™u qu·∫£ t√°o?",
          g: 3,
          it: 4,
        },
        {
          story:
            "Nam c√≥ 5 t√∫i k·∫πo, m·ªói t√∫i ch·ª©a 2 chi·∫øc. C·∫≠u ·∫•y mu·ªën ƒë·∫øm xem m√¨nh c√≥ bao nhi√™u chi·∫øc k·∫πo.",
          g: 5,
          it: 2,
        },
        {
          story:
            "Trong v∆∞·ªùn, b√† Lan tr·ªìng 4 h√†ng hoa, m·ªói h√†ng c√≥ 3 c√¢y üåπ. H·ªèi t·∫•t c·∫£ c√≥ bao nhi√™u c√¢y hoa?",
          g: 4,
          it: 3,
        },
        {
          story:
            "C·ª≠a h√†ng c√≥ 6 h·ªôp chu·ªëi, m·ªói h·ªôp 5 qu·∫£. Nh√¢n vi√™n c·∫ßn ƒë·∫øm t·ªïng s·ªë qu·∫£ chu·ªëi trong c·ª≠a h√†ng.",
          g: 6,
          it: 5,
        },
        {
          story:
            "M·ªôt chu·ªìng c√≥ 3 con ch√≥, m·ªói con ƒëang gi·ªØ 4 chi·∫øc x∆∞∆°ng. H·ªèi trong chu·ªìng c√≥ t·ªïng c·ªông bao nhi√™u chi·∫øc x∆∞∆°ng?",
          g: 3,
          it: 4,
        },
        {
          story:
            "B√© Th·ªè chu·∫©n b·ªã b√°nh quy ƒë·ªÉ t·∫∑ng b·∫°n. B√© c√≥ 3 ƒëƒ©a b√°nh, m·ªói ƒëƒ©a c√≥ 6 chi·∫øc. B√© Th·ªè c√≥ t·∫•t c·∫£ bao nhi√™u chi·∫øc b√°nh?",
          g: 3,
          it: 6,
        },
        {
          story:
            "M√®o Mimi thu gom b√∫t m√†u. Mimi c√≥ 4 h·ªôp b√∫t, m·ªói h·ªôp c√≥ 5 c√¢y. Mimi c√≥ t·∫•t c·∫£ bao nhi√™u c√¢y b√∫t m√†u?",
          g: 4,
          it: 5,
        },
        {
          story:
            "G·∫•u B√¥ng ƒëang x·∫øp ly gi·∫•y cho bu·ªïi ti·ªác. C√≥ 2 ch·ªìng ly, m·ªói ch·ªìng c√≥ 8 c√°i. T·ªïng c·ªông c√≥ bao nhi√™u c√°i ly?",
          g: 2,
          it: 8,
        },
        {
          story:
            "Chim S√¢u mang hoa v·ªÅ l√†m t·ªï. M·ªói l·∫ßn mang ƒë∆∞·ª£c 3 b√¥ng, v√† n√≥ mang 7 l·∫ßn. N√≥ mang t·ªïng c·ªông bao nhi√™u b√¥ng hoa?",
          g: 7,
          it: 3,
        },
        {
          story:
            "Lan t√¥ tranh hoa h∆∞·ªõng d∆∞∆°ng. C√≥ 5 b√¥ng hoa, m·ªói b√¥ng c√≥ 4 c√°nh. Lan c·∫ßn t√¥ bao nhi√™u c√°nh hoa?",
          g: 5,
          it: 4,
        },
        {
          story:
            "B√© Na c√≥ 6 g√≥i d√°n sticker, m·ªói g√≥i c√≥ 5 h√¨nh ng√¥i sao. B√© Na c√≥ bao nhi√™u h√¨nh ng√¥i sao?",
          g: 6,
          it: 5,
        },
        {
          story:
            "Trong v∆∞·ªùn c√≥ 4 c√¢y t√°o, m·ªói c√¢y c√≥ 7 qu·∫£. T·∫•t c·∫£ c√≥ bao nhi√™u qu·∫£ t√°o tr√™n c√¢y?",
          g: 4,
          it: 7,
        },
        {
          story:
            "B√© H·ªï ƒëang x·∫øp s√°ch tr√™n k·ªá. C√≥ 3 ngƒÉn k·ªá, m·ªói ngƒÉn ƒë·∫∑t ƒë∆∞·ª£c 9 quy·ªÉn s√°ch. B√© H·ªï ƒë·∫∑t t·ªïng c·ªông bao nhi√™u quy·ªÉn?",
          g: 3,
          it: 9,
        },
        {
          story:
            "M·∫π mua 8 b√≥ hoa c√∫c, m·ªói b√≥ c√≥ 3 b√¥ng. M·∫π mua t·∫•t c·∫£ bao nhi√™u b√¥ng hoa c√∫c?",
          g: 8,
          it: 3,
        },
        {
          story:
            "B·∫°n Th·ªßy x·∫øp 5 h√†ng gh·∫ø cho l·ªõp h·ªçc, m·ªói h√†ng c√≥ 6 chi·∫øc gh·∫ø. T·ªïng c·ªông c√≥ bao nhi√™u chi·∫øc gh·∫ø?",
          g: 5,
          it: 6,
        },
        {
          story:
            "B√© Heo mang b√°nh m·ªùi b·∫°n. C√≥ 7 h·ªôp b√°nh, m·ªói h·ªôp 4 c√°i. B√© Heo mang bao nhi√™u c√°i b√°nh?",
          g: 7,
          it: 4,
        },
        {
          story:
            "Th·ªè Tr·∫Øng ƒëang bu·ªôc b√≥ng bay. M·ªói b√≥ c√≥ 8 qu·∫£ b√≥ng, c√≥ t·∫•t c·∫£ 2 b√≥. H·ªèi c√≥ bao nhi√™u qu·∫£ b√≥ng?",
          g: 2,
          it: 8,
        },
        {
          story:
            "G·∫•u Con ƒëang t√¥ hoa gi·∫•y. C√≥ 9 b√¥ng, m·ªói b√¥ng 5 c√°nh. G·∫•u Con t√¥ t·∫•t c·∫£ bao nhi√™u c√°nh?",
          g: 9,
          it: 5,
        },
        {
          story:
            "C√∫n ƒê·ªëm ph√°t ph·∫ßn th∆∞·ªüng. C√≥ 4 t√∫i qu√†, m·ªói t√∫i c√≥ 6 k·∫πo. T·ªïng c·ªông c√≥ bao nhi√™u vi√™n k·∫πo?",
          g: 4,
          it: 6,
        },
        {
          story:
            "B√© S√≥c trang tr√≠ c·ª≠a s·ªï. C√≥ 3 d√¢y treo, m·ªói d√¢y 10 l√° trang tr√≠. C√≥ bao nhi√™u l√° trang tr√≠ t·∫•t c·∫£?",
          g: 3,
          it: 10,
        },
        {
          story:
            "Trong s√¢n c√≥ 8 nh√≥m tr√≤ ch∆°i, m·ªói nh√≥m c√≥ 2 b·∫°n tham gia. C√≥ t·∫•t c·∫£ bao nhi√™u b·∫°n?",
          g: 8,
          it: 2,
        },
        {
          story:
            "M√®o Nh√≠ tr·ªìng hoa tulip. C√≥ 6 ch·∫≠u, m·ªói ch·∫≠u 7 hoa. M√®o Nh√≠ tr·ªìng bao nhi√™u hoa tulip?",
          g: 6,
          it: 7,
        },
        {
          story:
            "C√¥ gi√°o ph√°t nh√£n v·ªü. C√≥ 5 ch·ªìng nh√£n, m·ªói ch·ªìng 9 t·ªù. T·ªïng c·ªông c√¥ ph√°t bao nhi√™u t·ªù nh√£n?",
          g: 5,
          it: 9,
        },
        {
          story:
            "B√© Na ƒëang g·∫•p h·∫°c gi·∫•y. B√© g·∫•p 4 l·∫ßn, m·ªói l·∫ßn 8 con h·∫°c. B√© g·∫•p bao nhi√™u con h·∫°c t·∫•t c·∫£?",
          g: 4,
          it: 8,
        },
        {
          story:
            "Th·ªè Nh·ªè treo ƒë√®n l·ªìng. C√≥ 7 d√¢y ƒë√®n, m·ªói d√¢y c√≥ 6 chi·∫øc ƒë√®n nh·ªè. Th·ªè Nh·ªè treo bao nhi√™u chi·∫øc ƒë√®n l·ªìng t·∫•t c·∫£?",
          g: 7,
          it: 6,
        },
        {
          story:
            "B√© C·ª´u chu·∫©n b·ªã b√°nh trung thu. C√≥ 4 h·ªôp b√°nh, m·ªói h·ªôp c√≥ 8 chi·∫øc. B√© C·ª´u c√≥ bao nhi√™u chi·∫øc b√°nh?",
          g: 4,
          it: 8,
        },
        {
          story:
            "Trong l·ªõp c√≥ 3 b√†n tr·ªìng c√¢y, m·ªói b√†n tr·ªìng 7 ch·∫≠u. C·∫£ l·ªõp tr·ªìng bao nhi√™u ch·∫≠u c√¢y?",
          g: 3,
          it: 7,
        },
        {
          story:
            "B√© Nai c√≥ 5 x·∫•p gi·∫•y m√†u, m·ªói x·∫•p c√≥ 6 t·ªù. B√© Nai c√≥ bao nhi√™u t·ªù gi·∫•y m√†u?",
          g: 5,
          it: 6,
        },
        {
          story:
            "B√°c g·∫•u l√†m b√°nh r√°n üç©. L√†m 2 khay, m·ªói khay c√≥ 9 c√°i. B√°c l√†m t·∫•t c·∫£ bao nhi√™u c√°i b√°nh?",
          g: 2,
          it: 9,
        },
        {
          story:
            "S∆°n c·∫•t v·ªü v√†o t·ªß. C√≥ 7 ngƒÉn t·ªß, m·ªói ngƒÉn ƒë·ªÉ ƒë∆∞·ª£c 4 quy·ªÉn v·ªü. S∆°n ƒë·ªÉ t·∫•t c·∫£ bao nhi√™u quy·ªÉn v·ªü?",
          g: 7,
          it: 4,
        },
        {
          story:
            "C√≥ 6 ƒëo√†n t√†u ƒë·ªì ch∆°i üöÇ, m·ªói ƒëo√†n c√≥ 3 toa. T·∫•t c·∫£ c√≥ bao nhi√™u toa t√†u?",
          g: 6,
          it: 3,
        },
        {
          story:
            "Th·ªè H·ªìng g·∫•p gi·∫•y th√†nh b√¥ng hoa. B√© g·∫•p 8 l·∫ßn, m·ªói l·∫ßn ƒë∆∞·ª£c 5 b√¥ng. B√© g·∫•p bao nhi√™u b√¥ng hoa?",
          g: 8,
          it: 5,
        },
        {
          story:
            "Trong r·ª´ng c√≥ 5 nh√≥m s√≥c üéí ƒëi nh·∫∑t h·∫°t, m·ªói nh√≥m c√≥ 3 b·∫°n. C√≥ bao nhi√™u b·∫°n s√≥c t·∫•t c·∫£?",
          g: 5,
          it: 3,
        },
        {
          story:
            "G·∫•u Con x·∫øp g·ªëi ng·ªß. C√≥ 9 gi∆∞·ªùng, m·ªói gi∆∞·ªùng 2 chi·∫øc g·ªëi. C√≥ bao nhi√™u chi·∫øc g·ªëi?",
          g: 9,
          it: 2,
        },
        {
          story:
            "B√© Th·ªè v·∫Ω m·∫∑t tr·ªùi ‚òÄÔ∏è. B√© v·∫Ω 4 b·ª©c tranh, m·ªói b·ª©c c√≥ 7 m·∫∑t tr·ªùi. B√© v·∫Ω bao nhi√™u m·∫∑t tr·ªùi?",
          g: 4,
          it: 7,
        },
        {
          story:
            "C√∫n B√¥ng ƒëang ph√¢n chia ƒë·ªì ch∆°i. C√≥ 3 h·ªôp xe h∆°i, m·ªói h·ªôp 10 chi·∫øc. C√∫n c√≥ bao nhi√™u xe h∆°i?",
          g: 3,
          it: 10,
        },
        {
          story:
            "Nh√† Ong c√≥ 8 c·ª•m hoa tr∆∞·ªõc c·ª≠a, m·ªói c·ª•m c√≥ 4 b√¥ng. T·ªïng c·ªông c√≥ bao nhi√™u b√¥ng hoa?",
          g: 8,
          it: 4,
        },
        {
          story:
            "B·∫°n H·∫° treo thi·ªáp ch√∫c m·ª´ng. C√≥ 2 d√¢y treo, m·ªói d√¢y 10 thi·ªáp üéâ. C√≥ bao nhi√™u thi·ªáp t·∫•t c·∫£?",
          g: 2,
          it: 10,
        },
        {
          story:
            "M√®o M∆∞·ªõp ƒë·∫øm d√©p tr∆∞·ªõc c·ª≠a. C√≥ 5 c·∫∑p d√©p, m·ªói c·∫∑p c√≥ 2 chi·∫øc. C√≥ bao nhi√™u chi·∫øc d√©p?",
          g: 5,
          it: 2,
        },
        {
          story:
            "B√© G√† mang 6 r·ªï tr·ª©ng, m·ªói r·ªï c√≥ 5 qu·∫£. B√© G√† mang bao nhi√™u qu·∫£ tr·ª©ng?",
          g: 6,
          it: 5,
        },
        {
          story:
            "Trong h·ªì c√≥ 7 ƒë√†n c√° üêü, m·ªói ƒë√†n c√≥ 3 con. H·ªì c√≥ bao nhi√™u con c√°?",
          g: 7,
          it: 3,
        },
        {
          story:
            "L·ªõp h·ªçc c√≥ 4 h·ªôp b√∫t ch√¨, m·ªói h·ªôp c√≥ 8 chi·∫øc. C√≥ bao nhi√™u b√∫t ch√¨ trong l·ªõp?",
          g: 4,
          it: 8,
        },
        {
          story:
            "B·∫°n Bi t√¥ tranh hoa mai. C√≥ 8 b√¥ng, m·ªói b√¥ng 6 c√°nh. B·∫°n Bi t√¥ bao nhi√™u c√°nh hoa?",
          g: 8,
          it: 6,
        },
        {
          story:
            "B√© G·∫•u ƒëi mua sticker ‚≠ê. B√© mua 9 t·ªù, m·ªói t·ªù c√≥ 4 sticker. B√© c√≥ bao nhi√™u sticker?",
          g: 9,
          it: 4,
        },
        {
          story:
            "Th·ªè Tr·∫Øng tr·ªìng c√† r·ªët ü•ï. C√≥ 6 lu·ªëng, m·ªói lu·ªëng 7 c√¢y. T·∫•t c·∫£ c√≥ bao nhi√™u c√¢y c√† r·ªët?",
          g: 6,
          it: 7,
        },
      ];

      let quizQ = [];
      let currentQuiz = 0;
      let score = 0;

      function makeQuiz() {
        quizQ = [];
        score = 0;
        const used = new Set();
        while (quizQ.length < quizStories.length) {
          const idx = Math.floor(Math.random() * quizStories.length);
          if (!used.has(idx)) {
            used.add(idx);
            quizQ.push(quizStories[idx]);
          }
        }
        currentQuiz = 0;
        showQuiz();
      }
      function showQuiz() {
        if (!quizQ.length) return;
        const q = quizQ[currentQuiz];
        quizStep.textContent = currentQuiz + 1;
        quizQuestion.textContent = q.story;
        const correct = q.g * q.it;
        const wrong =
          correct +
          (Math.random() < 0.5
            ? -(Math.floor(Math.random() * 3) + 1)
            : Math.floor(Math.random() * 3) + 1);
        if (Math.random() < 0.5) {
          answerA.textContent = correct;
          answerA.dataset.correct = "1";
          answerB.textContent = wrong;
          answerB.dataset.correct = "";
        } else {
          answerB.textContent = correct;
          answerB.dataset.correct = "1";
          answerA.textContent = wrong;
          answerA.dataset.correct = "";
        }
        quizFeedback.textContent = "";
      }

      [answerA, answerB].forEach((btn) =>
        btn.addEventListener("click", () => {
          if (btn.dataset.correct) {
            score++;
            quizFeedback.textContent = "Ch√≠nh x√°c! üéâ";
            quizFeedback.style.color = "green";
          } else {
            quizFeedback.textContent = "Ch∆∞a ƒë√∫ng, th·ª≠ l·∫ßn sau nh√© üòä";
            quizFeedback.style.color = "#cc4b4b";
          }
          setTimeout(() => {
            currentQuiz++;
            if (currentQuiz < quizQ.length) showQuiz();
            else {
              quizFeedback.style.color = "#ff6f00";
              quizFeedback.textContent = `üéâ B·∫°n ƒë√£ ho√†n th√†nh! B·∫°n tr·∫£ l·ªùi ƒë√∫ng ${score}/${quizQ.length} c√¢u.`;
              retryQuizBtn.style.display = "inline-block";
            }
          }, 900);
        })
      );
      retryQuizBtn.addEventListener("click", () => {
        makeQuiz();
        quizFeedback.textContent = "";
        retryQuizBtn.style.display = "none";
      });
      speakQuizBtn.addEventListener("click", () => {
        if (quizQ[currentQuiz]) speak(quizQ[currentQuiz].story);
      });

      // --------------------------
      // Multiplication table (1..12) + theme
      // --------------------------
      const multiplicationButtons = document.getElementById(
        "multiplicationButtons"
      );
      const multiplicationDisplay = document.getElementById(
        "multiplicationDisplay"
      );
      const readTableBtn = document.getElementById("readTableBtn");
      let currentTable = 1;
      let multiplicationInited = false;

      function multiplicationButtonsHasChildren() {
        return (
          multiplicationButtons && multiplicationButtons.children.length > 0
        );
      }

      function initMultiplicationButtons() {
        if (multiplicationInited) return;
        multiplicationInited = true;
        // create buttons 1..12
        for (let n = 1; n <= 9; n++) {
          const btn = document.createElement("button");
          btn.textContent = n;
          btn.addEventListener("click", () => {
            currentTable = n;
            updateTable(n);
            highlightActive(btn);
          });
          multiplicationButtons.appendChild(btn);
        }
      }

      function updateTable() {
        multiplicationDisplay.innerHTML = "";
        for (let i = 1; i <= 10; i++) {
          let line = document.createElement("div");
          line.textContent = `${currentTable} √ó ${i} = ${currentTable * i}`;
          line.addEventListener("click", () => {
            speak(`${currentTable} nh√¢n ${i} b·∫±ng ${currentTable * i}`);
          });
          multiplicationDisplay.appendChild(line);
        }
        updateTableTheme();
      }

      function updateTableTheme() {
        const pastelColors = [
          "#ffeff5",
          "#fff3d9",
          "#e7ffe5",
          "#dff5ff",
          "#f4e4ff",
          "#ffe9d6",
          "#d6fffa",
          "#ffe3fb",
          "#ffe9e9",
        ];
        multiplicationDisplay.style.background = pastelColors[currentTable - 1];
        multiplicationDisplay.style.border = "3px solid #ffc6db";
        multiplicationDisplay.style.borderRadius = "18px";
        multiplicationDisplay.style.padding = "18px";
        multiplicationDisplay.style.transition = "0.3s";
      }

      function highlightActive(activeBtn) {
        document
          .querySelectorAll("#multiplicationButtons button")
          .forEach((b) => b.classList.remove("active"));
        if (activeBtn) activeBtn.classList.add("active");
      }

      readTableBtn.addEventListener("click", () => {
        let text = "";
        for (let i = 1; i <= 10; i++)
          text += `${currentTable} nh√¢n ${i} b·∫±ng ${currentTable * i}. `;
        speak(text);
      });

      // --------------------------
      // Matching game (cards)
      // --------------------------
      const gameArea = document.getElementById("gameArea");
      const newGameBtn = document.getElementById("newGameBtn");
      let firstCard = null;
      let lockBoard = false;

      function createGame() {
        gameArea.innerHTML = "";
        const cards = [];
        // create 6 pairs (we show 8 cards = 4 pairs earlier; now create 6 pairs for more variety)
        const pairsCount = 6;
        for (let i = 1; i <= pairsCount; i++) {
          const result = currentTable * i;
          cards.push({
            text: `${currentTable} √ó ${i}`,
            value: result,
            type: "exp",
          });
          cards.push({ text: String(result), value: result, type: "ans" });
        }
        // shuffle
        cards.sort(() => Math.random() - 0.5);
        // create elements
        cards.forEach((c) => {
          const cardEl = document.createElement("div");
          cardEl.className = "game-card";
          cardEl.textContent = c.text;
          cardEl.dataset.value = c.value;
          cardEl.dataset.type = c.type;
          gameArea.appendChild(cardEl);
        });
        setupCardEvents();
      }

      function setupCardEvents() {
        document.querySelectorAll(".game-card").forEach((card) => {
          // remove previous handlers by cloning (safe)
          const newCard = card.cloneNode(true);
          card.parentNode.replaceChild(newCard, card);
        });
        document.querySelectorAll(".game-card").forEach((card) => {
          card.addEventListener("click", () => {
            if (lockBoard || card.classList.contains("matched")) return;
            card.style.background = "#fff2c2";
            if (!firstCard) {
              firstCard = card;
            } else {
              lockBoard = true;
              if (
                firstCard.dataset.value === card.dataset.value &&
                firstCard.dataset.type !== card.dataset.type
              ) {
                // matched
                firstCard.classList.add("matched");
                card.classList.add("matched");
                speak("Ch√≠nh x√°c!");
                setTimeout(() => {
                  firstCard.style.background = "";
                  card.style.background = "";
                }, 300);
              } else {
                speak("Ch∆∞a ƒë√∫ng r·ªìi, th·ª≠ l·∫°i nh√©!");
                setTimeout(() => {
                  firstCard.style.background = "";
                  card.style.background = "";
                }, 400);
              }
              setTimeout(() => {
                firstCard = null;
                lockBoard = false;
                checkWin();
              }, 500);
            }
          });
        });
      }

      newGameBtn.addEventListener("click", () => {
        createGame();
        startTimer();
      });

      // --------------------------
      // Timer + stickers
      // --------------------------
      let timeLeft = 30;
      let timer = null;
      let stickers = Number(localStorage.getItem("stickers") || 0);
      document.getElementById("stickerCount").textContent = stickers;

      function startTimer() {
        clearInterval(timer);
        timeLeft = 30;
        updateTimerDisplay();
        timer = setInterval(() => {
          timeLeft--;
          updateTimerDisplay();
          if (timeLeft <= 0) {
            clearInterval(timer);
            endGame(false);
          }
        }, 1000);
      }
      function updateTimerDisplay() {
        const t = document.getElementById("timerDisplay");
        t.textContent = `‚è±Ô∏è ${timeLeft}s`;
        if (timeLeft <= 10) t.classList.add("blink");
        else t.classList.remove("blink");
      }
      function checkWin() {
        const unmatched = document.querySelectorAll(".game-card:not(.matched)");
        if (unmatched.length === 0) {
          endGame(true);
        }
      }
      function endGame(win) {
        clearInterval(timer);
        if (win) {
          speak("Tuy·ªát v·ªùi! Con ƒë√£ th·∫Øng!");
          earnSticker();
        } else {
          speak("H·∫øt th·ªùi gian r·ªìi! Ch∆°i l·∫°i nh√©!");
        }
      }
      function earnSticker() {
        stickers++;
        localStorage.setItem("stickers", stickers);
        document.getElementById("stickerCount").textContent = stickers;
        const earned = document.createElement("div");
        earned.textContent = "‚≠ê";
        earned.className = "sticker-earned";
        earned.style.position = "fixed";
        earned.style.left = "50%";
        earned.style.top = "40%";
        earned.style.transform = "translate(-50%, -50%)";
        earned.style.zIndex = "9999";
        document.body.appendChild(earned);
        setTimeout(() => earned.remove(), 900);
      }

      // --------------------------
      // Initialization
      // --------------------------
      updatePreview();
      renderGroups();
      makeQuiz();
      // default: show learn
      showLearn();

      // when user switches to tables, initialize buttons if necessary
      initMultiplicationButtons();
      highlightActive(
        document.querySelectorAll("#multiplicationButtons button")[0]
      );
      updateTable(1);
      createGame();

      // accessibility
      document.addEventListener("keydown", (e) => {
        if (e.key === " ") {
          e.preventDefault();
          speakBtn.click();
        }
      });

      /* ---------------------------
        Mini-game: B·∫Øn B√≥ng K·∫øt Qu·∫£
        - balloons fly bottom -> top
        - candy reward, pop sound, levels, highscore
      ---------------------------- */

      (() => {
        const popSound = new Audio(
          "https://assets.mixkit.co/sfx/preview/mixkit-pop-106.mp3"
        );
        popSound.volume = 0.55;

        const balloonArea = document.getElementById("balloonArea");
        const questionEl = document.getElementById("shootQuestion");
        const shootRewardEl = document.getElementById("shootReward");
        const shootHighEl = document.getElementById("shootHighScore");
        const levelBadge = document.getElementById("levelBadge");

        let shootScore = 0;
        let shootHighScore =
          Number(localStorage.getItem("shootHighScore")) || 0;
        shootHighEl.textContent = shootHighScore;

        let shootCorrectAnswer = null,
          spawnIntervalId = null,
          active = false,
          currentLevel = 1,
          balloonIds = 0;
        let usedRecentQuestions = new Set(),
          baseDuration = parseInt(
            document.querySelector(".speed-btn.active").dataset.speed
          );
        let currentAnswerPool = [],
          correctBalloonSpawned = false;

        document.querySelectorAll(".speed-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".speed-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            baseDuration = parseInt(btn.dataset.speed);
            if (active) restartSpawnInterval();
          });
        });

        document
          .getElementById("startBtn")
          .addEventListener("click", startShootGame);
        document
          .getElementById("stopBtn")
          .addEventListener("click", stopShootGame);
        document
          .getElementById("resetHighBtn")
          .addEventListener("click", () => {
            localStorage.removeItem("shootHighScore");
            shootHighScore = 0;
            shootHighEl.textContent = 0;
          });

        function rand(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        function randomFromSet(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        }

        function startShootGame() {
          stopShootGame();
          shootScore = 0;
          currentLevel = 1;
          levelBadge.textContent = currentLevel;
          shootRewardEl.textContent = shootScore;
          nextQuestion();
          active = true;
        }

        function stopShootGame() {
          active = false;
          clearInterval(spawnIntervalId);
          spawnIntervalId = null;
          balloonArea.innerHTML = "";
          usedRecentQuestions.clear();
        }

        function nextQuestion() {
          // Ch·ªâ x√≥a bong b√≥ng, gi·ªØ l·∫°i k·∫πo ƒëang bay
          const balloons = balloonArea.querySelectorAll(".balloon");
          balloons.forEach((balloon) => balloon.remove());
          
          let a, b, key;
          do {
            a = rand(1, 9);
            b = rand(1, 10);
            key = `${a}x${b}`;
          } while (
            usedRecentQuestions.has(key) &&
            usedRecentQuestions.size < 80
          );
          usedRecentQuestions.add(key);
          if (usedRecentQuestions.size > 80) usedRecentQuestions.clear();
          shootCorrectAnswer = a * b;
          questionEl.textContent = `${a} √ó ${b} = ?`;

          const answers = new Set([shootCorrectAnswer]);
          while (answers.size < 6) answers.add(rand(1, 90));
          currentAnswerPool = [...answers].sort(() => Math.random() - 0.5);

          correctBalloonSpawned = false;
          spawnBalloonBatch();
          restartSpawnInterval();
        }

        function restartSpawnInterval() {
          clearInterval(spawnIntervalId);
          spawnIntervalId = setInterval(() => {
            if (active) spawnBalloonBatch();
          }, Math.max(800, baseDuration));
        }

        function spawnBalloonBatch() {
          const batchSize = rand(3, 5);
          const positions = [];
          const correctIndex = rand(0, batchSize - 1);
          const minDistance = 18; // TƒÉng kho·∫£ng c√°ch t·ªëi thi·ªÉu t·ª´ 12% l√™n 18%

          // L·∫•y danh s√°ch c√°c bong b√≥ng hi·ªán c√≥ ƒë·ªÉ ki·ªÉm tra collision
          const existingBalloons = Array.from(balloonArea.querySelectorAll(".balloon"));
          const areaWidth = balloonArea.offsetWidth || 900; // Fallback n·∫øu ch∆∞a render
          const balloonSize = 68; // K√≠ch th∆∞·ªõc bong b√≥ng
          const minDistancePx = (areaWidth * minDistance) / 100; // Chuy·ªÉn % sang px
          
          // H√†m helper ƒë·ªÉ t√¨m v·ªã tr√≠ h·ª£p l·ªá
          function findValidPosition(isCorrectBalloon = false) {
            let leftPct, bottomOffset;
            let attempts = 0;
            const maxAttempts = isCorrectBalloon ? 200 : 100; // Bong b√≥ng ƒë√∫ng c√≥ nhi·ªÅu l·∫ßn th·ª≠ h∆°n
            
            do {
              leftPct = rand(5, 85);
              bottomOffset = rand(0, 30);
              
              // T√≠nh to√°n v·ªã tr√≠ pixel c·ªßa bong b√≥ng m·ªõi
              const newLeftPx = (areaWidth * leftPct) / 100;
              
              // Ki·ªÉm tra v·ªõi c√°c v·ªã tr√≠ trong batch hi·ªán t·∫°i
              const tooCloseToBatch = positions.some((p) => {
                const existingLeftPx = (areaWidth * p) / 100;
                return Math.abs(existingLeftPx - newLeftPx) < minDistancePx;
              });
              
              // Ki·ªÉm tra collision v·ªõi c√°c bong b√≥ng ƒëang bay
              let hasCollision = false;
              if (existingBalloons.length > 0 && balloonArea.offsetWidth > 0) {
                const areaRect = balloonArea.getBoundingClientRect();
                const newBottomPx = -60 - bottomOffset;
                
                hasCollision = existingBalloons.some((balloon) => {
                  const rect = balloon.getBoundingClientRect();
                  const balloonLeftPx = rect.left - areaRect.left + rect.width / 2;
                  const newBalloonCenterPx = newLeftPx;
                  const balloonBottomPx = areaRect.bottom - rect.bottom;
                  const newBalloonBottomPx = areaRect.height + newBottomPx;
                  const distanceX = Math.abs(balloonLeftPx - newBalloonCenterPx);
                  const distanceY = Math.abs(balloonBottomPx - newBalloonBottomPx);
                  
                  // V·ªõi bong b√≥ng ƒë√∫ng, y√™u c·∫ßu collision detection l·ªèng h∆°n m·ªôt ch√∫t
                  const collisionPadding = isCorrectBalloon ? 10 : 15;
                  
                  if (distanceY < 150) {
                    return distanceX < (balloonSize + collisionPadding);
                  }
                  
                  return false;
                });
              }
              
              if (!tooCloseToBatch && !hasCollision) {
                return { leftPct, bottomOffset, found: true };
              }
              
              attempts++;
            } while (attempts < maxAttempts);
            
            // N·∫øu l√† bong b√≥ng ƒë√∫ng v√† kh√¥ng t√¨m ƒë∆∞·ª£c v·ªã tr√≠ sau nhi·ªÅu l·∫ßn th·ª≠,
            // th·ª≠ l·∫°i v·ªõi y√™u c·∫ßu collision detection l·ªèng h∆°n
            if (isCorrectBalloon && attempts >= maxAttempts) {
              // Th·ª≠ l·∫°i v·ªõi kho·∫£ng c√°ch t·ªëi thi·ªÉu nh·ªè h∆°n
              for (let retry = 0; retry < 50; retry++) {
                leftPct = rand(5, 85);
                bottomOffset = rand(0, 30);
                const newLeftPx = (areaWidth * leftPct) / 100;
                
                // Ch·ªâ ki·ªÉm tra collision nghi√™m ng·∫∑t v·ªõi c√°c bong b√≥ng ƒëang bay ·ªü g·∫ßn
                let hasSevereCollision = false;
                if (existingBalloons.length > 0 && balloonArea.offsetWidth > 0) {
                  const areaRect = balloonArea.getBoundingClientRect();
                  const newBottomPx = -60 - bottomOffset;
                  
                  hasSevereCollision = existingBalloons.some((balloon) => {
                    const rect = balloon.getBoundingClientRect();
                    const balloonLeftPx = rect.left - areaRect.left + rect.width / 2;
                    const distanceX = Math.abs(balloonLeftPx - (areaWidth * leftPct) / 100);
                    const balloonBottomPx = areaRect.bottom - rect.bottom;
                    const newBalloonBottomPx = areaRect.height + newBottomPx;
                    const distanceY = Math.abs(balloonBottomPx - newBalloonBottomPx);
                    
                    // Ch·ªâ coi l√† collision nghi√™m tr·ªçng n·∫øu overlap r√µ r√†ng
                    return distanceY < 50 && distanceX < balloonSize;
                  });
                }
                
                if (!hasSevereCollision) {
                  return { leftPct, bottomOffset, found: true };
                }
              }
            }
            
            return { leftPct: null, bottomOffset: null, found: false };
          }
          
          // B∆Ø·ªöC 1: Spawn bong b√≥ng ƒë√∫ng TR∆Ø·ªöC (quan tr·ªçng nh·∫•t)
          const correctPosition = findValidPosition(true);
          if (correctPosition.found) {
            positions.push(correctPosition.leftPct);
            spawnBalloon(shootCorrectAnswer, correctPosition.leftPct, correctPosition.bottomOffset);
            correctBalloonSpawned = true;
          } else {
            // N·∫øu kh√¥ng t√¨m ƒë∆∞·ª£c v·ªã tr√≠ cho bong b√≥ng ƒë√∫ng, kh√¥ng spawn batch n√†y
            return;
          }
          
          // B∆Ø·ªöC 2: Spawn c√°c bong b√≥ng kh√°c
          for (let i = 0; i < batchSize; i++) {
            // B·ªè qua bong b√≥ng ƒë√∫ng v√¨ ƒë√£ spawn r·ªìi
            if (i === correctIndex) continue;
            
            // Ch·ªçn s·ªë sai
            let num;
            let candidate;
            do {
              candidate = randomFromSet(currentAnswerPool);
            } while (candidate === shootCorrectAnswer);
            num = candidate;
            
            const position = findValidPosition(false);
            if (position.found) {
              positions.push(position.leftPct);
              spawnBalloon(num, position.leftPct, position.bottomOffset);
            }
            // N·∫øu kh√¥ng t√¨m ƒë∆∞·ª£c v·ªã tr√≠ cho bong b√≥ng sai, b·ªè qua (kh√¥ng quan tr·ªçng)
          }
        }

        function spawnBalloon(num, leftPct = null, bottomOffset = null) {
          const id = ++balloonIds;
          const b = document.createElement("div");
          b.className = "balloon";
          b.dataset.id = id;
          b.textContent = num;

          const palettes = [
            ["#fff6fb", "#ffd7f0"],
            ["#fff9ec", "#fff0d6"],
            ["#f0fff7", "#d8fff0"],
            ["#fff7ff", "#f7e9ff"],
          ];
          const p = palettes[rand(0, palettes.length - 1)];
          b.style.background = `radial-gradient(circle at 28% 28%, ${p[0]}, ${p[1]})`;
          b.style.color = "#7a2a59";
          
          // ƒê·∫∑t v·ªã tr√≠ ngang
          if (leftPct === null) leftPct = rand(5, 85);
          b.style.left = leftPct + "%";
          
          // ƒê·∫∑t z-index tƒÉng d·∫ßn ƒë·ªÉ bong b√≥ng m·ªõi lu√¥n ·ªü tr√™n
          b.style.zIndex = (10 + id).toString();

          const floatDur = Math.max(
            0.9,
            baseDuration / 1000 - (currentLevel - 1) * 0.35
          );
          b.style.animation = `floatUp ${floatDur}s linear forwards`;
          
          // S·ª≠ d·ª•ng bottomOffset n·∫øu ƒë∆∞·ª£c cung c·∫•p, n·∫øu kh√¥ng th√¨ random
          if (bottomOffset !== null) {
            b.style.bottom = (-60 - bottomOffset) + "px";
          } else {
            b.style.bottom = -60 - Math.random() * 30 + "px";
          }

          b.addEventListener("click", (ev) => {
            if (!active) return;
            const val = Number(b.textContent);
            if (val === shootCorrectAnswer) {
              // d·ª´ng float animation v√† n·ªï
              b.style.animation = "";
              explodeBalloon(b);
              // Delay ƒë·ªÉ k·∫πo c√≥ th·ªùi gian hi·ªÉn th·ªã tr∆∞·ªõc khi chuy·ªÉn c√¢u h·ªèi
              setTimeout(() => {
                handleCorrect();
              }, 500);
            } else {
              b.style.transform = "translateY(-6px) scale(1.06)";
              b.style.background = "#ffd7d7";
              setTimeout(() => (b.style.transform = ""), 180);
            }
            ev.stopPropagation();
          });

          // remove bong b√≥ng khi bay h·∫øt n·∫øu ch∆∞a b·ªã click ƒë√∫ng
          b.addEventListener("animationend", () => {
            if (b.parentNode && !b.classList.contains("pop")) b.remove();
          });

          balloonArea.appendChild(b);

          setTimeout(() => {
            if (b.parentNode && !b.classList.contains("pop")) b.remove();
          }, Math.max(6000, floatDur * 1000 + 900));
        }

        function explodeBalloon(balloonEl) {
          // Ph√°t √¢m thanh n·ªï (kh√¥ng ch·∫∑n n·∫øu l·ªói)
          popSound.currentTime = 0;
          popSound.play().catch(() => {
            // B·ªè qua l·ªói n·∫øu kh√¥ng ph√°t ƒë∆∞·ª£c √¢m thanh
          });

          // Th√™m class pop ƒë·ªÉ bong b√≥ng n·ªï
          balloonEl.classList.add("pop");

          // S·ª≠ d·ª•ng requestAnimationFrame ƒë·ªÉ ƒë·∫£m b·∫£o v·ªã tr√≠ ƒë∆∞·ª£c t√≠nh ch√≠nh x√°c
          requestAnimationFrame(() => {
            const areaRect = balloonArea.getBoundingClientRect();
            const rect = balloonEl.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2 - areaRect.left;
            const centerY = rect.top + rect.height / 2 - areaRect.top;

            // M·∫£ng c√°c lo·∫°i k·∫πo kh√°c nhau
            const candies = ["üç¨", "üç≠", "üç´", "üç∞", "üç™", "‚≠ê", "üí´", "‚ú®"];
            
            // T·∫°o nhi·ªÅu k·∫πo bay ra (tƒÉng t·ª´ 8 l√™n 15)
            const candyCount = 15;
            for (let i = 0; i < candyCount; i++) {
              const c = document.createElement("div");
              c.className = "candy-splash";
              // Ch·ªçn ng·∫´u nhi√™n m·ªôt lo·∫°i k·∫πo
              c.textContent = randomFromSet(candies);
              
              // ƒê·∫∑t v·ªã tr√≠ ban ƒë·∫ßu t·∫°i t√¢m bong b√≥ng
              c.style.position = "absolute";
              c.style.left = centerX + "px";
              c.style.top = centerY + "px";
              
              // T·∫°o h∆∞·ªõng bay ng·∫´u nhi√™n v·ªõi g√≥c ph√¢n b·ªë ƒë·ªÅu (360 ƒë·ªô)
              const angle = (i / candyCount) * Math.PI * 2 + Math.random() * 0.3;
              const distance = 120 + Math.random() * 80; // Kho·∫£ng c√°ch bay
              const dx = (Math.cos(angle) * distance).toFixed(0) + "px";
              const dy = (Math.sin(angle) * distance - 30).toFixed(0) + "px"; // H∆°i bay l√™n tr√™n
              const dxMid = (Math.cos(angle) * distance * 0.6).toFixed(0) + "px";
              const dyMid = (Math.sin(angle) * distance * 0.6 - 30).toFixed(0) + "px";
              
              c.style.setProperty("--dx", dx);
              c.style.setProperty("--dy", dy);
              c.style.setProperty("--dx-mid", dxMid);
              c.style.setProperty("--dy-mid", dyMid);
              
              // Th·ªùi gian animation ng·∫´u nhi√™n ƒë·ªÉ t·ª± nhi√™n h∆°n
              const duration = 0.8 + Math.random() * 0.4;
              c.style.animation =
                `candyFly ${duration}s cubic-bezier(.2,.8,.2,1) forwards`;
              
              balloonArea.appendChild(c);

              // X√≥a k·∫πo sau khi animation k·∫øt th√∫c
              setTimeout(() => {
                if (c.parentNode) c.remove();
              }, duration * 1000 + 100);
            }
          });

          // Remove bong b√≥ng sau khi pop animation k·∫øt th√∫c
          balloonEl.addEventListener("animationend", () => {
            if (balloonEl.parentNode) balloonEl.remove();
          });
        }

        function handleCorrect() {
          if (!active) return;
          shootScore++;
          shootRewardEl.textContent = shootScore;
          if (shootScore > shootHighScore) {
            shootHighScore = shootScore;
            localStorage.setItem("shootHighScore", shootHighScore);
            shootHighEl.textContent = shootHighScore;
          }
          if (shootScore % 8 === 0) {
            currentLevel++;
            levelBadge.textContent = currentLevel;
          }
          nextQuestion();
        }

        function initPlaceholder() {
          questionEl.textContent = 'Ch·∫°m "B·∫Øt ƒë·∫ßu" ƒë·ªÉ ch∆°i';
          balloonArea.innerHTML = "";
        }
        initPlaceholder();
      })();

      //Game 2
      let dragScore = 0;
      let previousDrag = null;

      function createDragQuestion() {
        let a, b;
        do {
          a = Math.floor(Math.random() * 9) + 1;
          b = Math.floor(Math.random() * 10) + 1;
        } while (`${a}x${b}` === previousDrag);
        previousDrag = `${a}x${b}`;
        const correct = a * b;

        document.getElementById("dragQuestion").textContent = `${a} √ó ${b} = ?`;
        const cards = new Set([correct]);
        while (cards.size < 6) cards.add(Math.floor(Math.random() * 81) + 1);

        const cardContainer = document.getElementById("dragCards");
        cardContainer.innerHTML = "";
        Array.from(cards)
          .sort(() => Math.random() - 0.5)
          .forEach((num) => {
            const card = document.createElement("div");
            card.className = "drag-card";
            card.textContent = num;
            card.draggable = true;

            card.addEventListener("dragstart", (e) => {
              e.dataTransfer.setData("text/plain", num);
            });

            cardContainer.appendChild(card);
          });
      }

      // ƒê∆∞a th·∫ª v√†o √¥
      const answerZone = document.getElementById("answerZone");
      answerZone.addEventListener("dragover", (e) => e.preventDefault());
      answerZone.addEventListener("drop", (e) => {
        e.preventDefault();
        const val = Number(e.dataTransfer.getData("text/plain"));
        const correct =
          Number(previousDrag.split("√ó")[0]) *
          Number(previousDrag.split("√ó")[1]);
        if (val === correct) {
          dragScore++;
          document.getElementById("dragScore").textContent = dragScore;
          answerZone.textContent = `${correct} ‚úî`;
          answerZone.style.borderColor = "#39b55a";
          setTimeout(() => {
            answerZone.textContent = "K√©o th·∫ª v√†o ƒë√¢y";
            answerZone.style.borderColor = "#ccc";
            createDragQuestion();
          }, 800);
        } else {
          answerZone.style.borderColor = "#cc4b4b";
          setTimeout(() => (answerZone.style.borderColor = "#ccc"), 400);
        }
      });

      // K√≠ch ho·∫°t game t·ª´ menu
      document.querySelector('[data-game="drag"]').onclick = () => {
        document
          .querySelectorAll(".practice-game")
          .forEach((g) => (g.style.display = "none"));
        document.getElementById("dragDropGame").style.display = "block";
        createDragQuestion();
      };

      //Game 3
      let lineScore = 0;

      function createMatchLineGame() {
        const pairs = [];
        while (pairs.length < 6) {
          const a = Math.floor(Math.random() * 9) + 1;
          const b = Math.floor(Math.random() * 10) + 1;
          const key = `${a}x${b}`;
          if (!pairs.some((p) => p.key === key))
            pairs.push({ key: key, value: a * b });
        }

        const leftCol = document.getElementById("leftColumn");
        const rightCol = document.getElementById("rightColumn");
        leftCol.innerHTML = "";
        rightCol.innerHTML = "";
        const rightShuffled = [...pairs].sort(() => Math.random() - 0.5);

        pairs.forEach((p) => {
          const div = document.createElement("div");
          div.className = "match-item";
          div.textContent = p.key;
          div.dataset.value = p.value;
          div.addEventListener("click", () => selectLeft(div));
          leftCol.appendChild(div);
        });

        rightShuffled.forEach((p) => {
          const div = document.createElement("div");
          div.className = "match-item";
          div.textContent = p.value;
          div.dataset.value = p.value;
          div.addEventListener("click", () => selectRight(div));
          rightCol.appendChild(div);
        });

        window.matchLeft = null;
        window.matchRight = null;
      }

      function selectLeft(div) {
        window.matchLeft = div;
      }

      function selectRight(div) {
        window.matchRight = div;
        if (window.matchLeft) {
          if (window.matchLeft.dataset.value === div.dataset.value) {
            window.matchLeft.classList.add("correct");
            div.classList.add("correct");
            lineScore++;
            document.getElementById("lineScore").textContent = lineScore;
            window.matchLeft.style.pointerEvents = "none";
            div.style.pointerEvents = "none";
          }
          window.matchLeft = null;
          window.matchRight = null;
        }
      }

      // K√≠ch ho·∫°t game t·ª´ menu
      document.querySelectorAll(".practice-menu button").forEach((btn) => {
        btn.onclick = () => {
          // C·∫≠p nh·∫≠t m√†u button: button ƒë∆∞·ª£c click c√≥ m√†u h·ªìng, c√°c button kh√°c m√†u v√†ng
          document.querySelectorAll(".practice-menu button").forEach((b) => {
            b.classList.add("secondary");
          });
          btn.classList.remove("secondary");
          
          document
            .querySelectorAll(".practice-game")
            .forEach((g) => (g.style.display = "none"));
          const gameId = btn.dataset.game;
          const target = document.getElementById(gameId + "Game");
          if (target) target.style.display = "block";

          // Reset ƒëi·ªÉm khi chuy·ªÉn game
          if (gameId === "shoot") {
            shootScore = 0;
            document.getElementById("shootScore").textContent = 0;
            createShootQuestion();
          }
          if (gameId === "drag") {
            dragScore = 0;
            document.getElementById("dragScore").textContent = 0;
            createDragQuestion();
          }
          if (gameId === "memory") {
            lineScore = 0;
            document.getElementById("lineScore").textContent = 0;
            createMatchLineGame();
          }
          if (gameId === "odd") {
            oddScore = 0;
            document.getElementById("oddScore").textContent = 0;
            generateOddOneOut();
          }
        };
      });

      //Game 4
      let oddScore = 0;

      function generateOddOneOut() {
        const optionsCount = Math.floor(Math.random() * 4) + 6; // 6-9 options
        const correctIdx = Math.floor(Math.random() * optionsCount);
        const oddOptions = [];

        for (let i = 0; i < optionsCount; i++) {
          let a = Math.floor(Math.random() * 9) + 1;
          let b = Math.floor(Math.random() * 10) + 1;
          let ans = a * b;
          if (i === correctIdx) {
            // t·∫°o sai s·ªë
            ans += Math.floor(Math.random() * 5) + 1;
            if (ans === a * b) ans += 1; // ƒë·∫£m b·∫£o kh√°c
            oddOptions.push({ text: `${a} √ó ${b} = ${ans}`, correct: false });
          } else {
            oddOptions.push({ text: `${a} √ó ${b} = ${ans}`, correct: true });
          }
        }

        const container = document.getElementById("oddOptions");
        container.innerHTML = "";
        oddOptions.forEach((opt) => {
          const card = document.createElement("div");
          card.className = "odd-card";
          card.textContent = opt.text;
          card.addEventListener("click", () => {
            if (opt.correct) {
              card.classList.add("wrong");
              alert("Ch·ªçn ch∆∞a ƒë√∫ng! H√£y t√¨m k·∫ª x√¢m nh·∫≠p!");
            } else {
              card.classList.add("correct");
              oddScore++;
              document.getElementById("oddScore").textContent = oddScore;
              setTimeout(generateOddOneOut, 500); // chuy·ªÉn b·ªô m·ªõi
            }
          });
          container.appendChild(card);
        });
      }

      // kh·ªüi ƒë·ªông game

      // generateOddOneOut();
    </script>
  </body>
</html>
